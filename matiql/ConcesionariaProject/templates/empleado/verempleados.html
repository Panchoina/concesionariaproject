{% extends 'Index.html' %}
{% load static %}



{% block contenido %}
    <nav class="navbar bg-body-tertiary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'homepag' %}">Bienvenido, {{ user.username }}</a>
            
            <!-- parte administrativa -->
            <a class="navbar-brand" href="{% url 'VenderAuto' %}">Vender un auto</a>
            <a class="navbar-brand" href="{% url 'RegistroEmpleado' %}">Agregar un administrador</a>
            <a class="navbar-brand" href="{% url 'listar' %}">Ver los administradores agregados</a>
            
            <!-- Botón Cerrar Sesión -->
        
            <form method="post" action="{% url 'logout' %}">
                {% csrf_token %}
                <input type="submit" class="btn btn-danger btn-large" value="salir" style="width: 100px;">
            </form>

            <div class="collapse navbar-collapse">
                
            </div>
        </div>
    </nav>
    <CEnter><div class="container" style="margin-top: 5%;">
        <div class="card card-body">
            <h1>Empleados Administrativos</h1>
            <table class="table table-bordered table-hover">
                <thead class="table-primary">
                    <tr>
                        <th>Run</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Dirección</th>
                        <th>FonoEmpleado</th>
                        <th>Gmail</th>
                        <th>Área</th>
                        <th>Contraseña</th>
                        <th>Fecha Nacimiento</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in lista %}
                    <tr>
                        <td>{{ item.rut }}</td>
                        <td>{{ item.nombre }}</td>
                        <td>{{ item.apellido }}</td>
                        <td>{{ item.direccion }}</td>
                        <td>{{ item.FonoEmpleado }}</td>
                        <td>{{ item.gmail }}</td>
                        <td>{{ item.area }}</td>
                        <td>*********</td>
                        <td>{{ item.FechaNacimiento }}</td>
                        <td nowrap>
                            <a href="{% url 'actualizar_empleados' item.rut %}" class="btn btn-warning">Editar</a>
                            <a href="#" onclick="eliminar('{{ item.rut }}')" class="btn btn-danger">Eliminar</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="10" class="text-center">No se encontraron empleados</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div></CEnter>
    <script>
        const eliminar = (id) => {
            Swal.fire({
                title: "¿Está seguro de eliminar el empleado?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6",
                confirmButtonText: "Eliminar"
            }).then((result) => {
                if (result.isConfirmed)
                    window.location.href = '/empleado/verempleado/' + id
            })
        }
        //función para exportar los datos a excel
        const exportar = () => {
    
            //capturamos el id del cargo seleccionado
            let cargo = document.getElementById('id_cargos').value
            //si el cargo es vacio lo cambia por un 0
            if(cargo == '')
                cargo = 0
            //url para descargar el excel
            const url = '/empleado/exportexcel/' + cargo
            //abre en otra ventana el archivo a descargar
            open(url,'_self')
        }
    </script>
{% endblock contenido %}
    